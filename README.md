# 古有科学上网，今有科学开发

最近几天断断续续完成了一个小项目，从开发环境到上线部署。竟然有一半的时间花在”科学“开发上，踩各种坑。


科学开发的前提是先学会科学上网，这个就不熬述了。这里只记录科学开发过程遇到的问题，避免以后浪费时间。

## npm镜像源的科学设置
在本地开发时，如果已经科学上网，此操作可以略去。不过设置成境内源同时关掉科学上网时，可以显著提高速度。看个人习惯。我用到这个主要是在境内服务器上构建项目时难以科学上网，必须设置境内源。

终端运行如下命令设置成境内源

`npm config set registry https://registry.npmmirror.com`

如果是在docker中，在install之前加上如下命令

`RUN npm config set registry https://registry.npmmirror.com`


## docker镜像源的科学设置(Linux)
docker官方镜像已经相当不稳定，处于不可用状态，如下设置境内源

```
vim /etc/docker/daemon.json

{
    "registry-mirrors": [
        "https://mirror.ccs.tencentyun.com",
        "https://hub-mirror.c.163.com",
        "https://mirror.baidubce.com"
    ]
}
```

重启docker服务

`systemctl restart docker`

## docker镜像源的科学设置(Mac)
打开Docker Desktop客户端，点右上角设置图标，左侧菜单进入Docker Engine，编辑配置文件（见上面Linux配置）后点右下角应用重启

## docker CentOS安装源
Docker官方安装源（`https://download.docker.com`）已经无法访问
`TODO`

## 科学部署

注意以下坑坑坑：
1. vercel部署很香，但是重点是，在<b>境内不可访问</b>，开开心心部署，最后发现访问不了（vercel提供的域名和自定义域名在境内均不可访问）。后续测试另一个项目可以“时不时”访问。可能还是和线路有关系。不管怎样，vercel部署终归是不稳定。
2. aws境外部署有风险，<b>ip污染严重</b>，遇到几次分配的固定ip无法访问，最后放弃，慎用
3. aws镜像服务在境内服务器上拉取时速度奇慢，测试过阿里云、腾讯云。可能和镜像地域和境内服务器位置有关。可能得看运气吧，没功夫详查。所以aws镜像虽然很便宜，境内还是没法用。
4. 最终还是决定在境内服务器部署。部署完毕，一切就绪，然后呢，我了个去，80端口未备案域名无法访问（我记得以前是有一段时间可以上线，超期未备案才封的）。打个措手不及，幸好找了一个备案过的域名临时借用下。调整项目代码，通过这个备案域名的子路径部署，最终得以整个项目周期三天完成上线。

感想总结：
1. 如果你的业务和国内没有关系，那么这都不是问题，学好科学上网，服务栈全部用境外服务即可。
2. 否则，没有境内政策合规考虑的话，找一个靠谱的境外服务器（IP稳定，延时够低）部署即可。
3. 再否则，踏踏实实的用境内服务器，在学习科学上网的基础上，再学好科学开发、科学部署。

